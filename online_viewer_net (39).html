<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Study Search • Google API • Shortcuts</title>
<style>
:root{
  --bg:#f6f7fb; --fg:#1e2329; --muted:#707887; --panel:#ffffff; --border:#e6e8ee; --accent:#1a73e8; --accent-ghost:rgba(26,115,232,.12); --shadow:0 10px 26px rgba(0,0,0,.10);
  --chip:#eef2ff; --chip-fg:#1e2329;
}
html[data-theme="dark"]{
  --bg:#0f1117; --fg:#e8eaf1; --muted:#a5adbb; --panel:#151923; --border:#262b36; --accent:#8fb5ff; --accent-ghost:rgba(143,181,255,.16); --shadow:0 12px 34px rgba(0,0,0,.55);
  --chip:#1a2030; --chip-fg:#e8eaf1;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
.wrapper{min-height:100%;display:grid;grid-template-rows:auto auto 1fr auto}

/* Topbar */
.topbar{
  position:sticky;top:0;z-index:10;
  display:flex;justify-content:space-between;align-items:center;gap:12px;
  padding:10px 14px;border-bottom:1px solid var(--border);background:var(--panel)
}
.brand-wrap{display:flex;align-items:center;gap:10px}
.bi-box{
  width:32px;height:32px;border-radius:10px;
  display:grid;place-items:center;font-weight:900;letter-spacing:.3px;
  background:var(--chip);color:var(--chip-fg);border:1px solid var(--border);
  user-select:none;
}
.brand-link{
  font-weight:800;text-decoration:none;color:var(--fg);
  border:1px solid var(--border);background:var(--panel);
  padding:8px 12px;border-radius:12px;box-shadow:var(--shadow);
  transition:box-shadow .2s ease, transform .12s ease;
}
.brand-link:hover{box-shadow:0 0 0 4px var(--accent-ghost), var(--shadow)}
.brand-link:active{transform:scale(.98)}
.actions{display:flex;gap:8px}
.iconbtn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  border:1px solid var(--border);background:var(--panel);color:var(--fg);
  border-radius:12px;padding:10px 14px;cursor:pointer;box-shadow:var(--shadow);
  transition:transform .15s ease, box-shadow .2s ease
}
.iconbtn:hover{box-shadow:0 0 0 4px var(--accent-ghost), var(--shadow)}
.iconbtn:active{transform:scale(.98)}
.icon{width:22px;height:22px;flex:0 0 22px}

/* Hero search outside/above content (Google-like) */
.hero{display:grid;place-items:center;padding:28px 12px;border-bottom:1px solid var(--border);background:var(--panel)}
.hero-inner{width:min(900px,92vw);display:flex;flex-direction:column;gap:12px;align-items:center}
.logo-dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px var(--accent-ghost)}
.search-shell{
  width:min(720px,92vw);
  display:flex;align-items:center;gap:10px;
  border:1px solid var(--border);background:var(--panel);
  border-radius:999px;padding:10px 14px;
  box-shadow:0 4px 18px rgba(0,0,0,.06);
  transition:box-shadow .2s ease, transform .12s ease, border-color .2s ease;
}
.search-shell:hover{box-shadow:0 10px 28px rgba(0,0,0,.10)}
.search-shell:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-ghost), 0 14px 34px rgba(0,0,0,.12);transform:translateY(-1px)}
.search-shell input{
  flex:1;border:none;background:transparent;outline:none;font-size:16px;color:var(--fg);
}
.search-shell .left-ico, .search-shell .right-ico{display:flex;align-items:center;gap:6px}
.icon-round{
  width:36px;height:36px;border-radius:999px;border:1px solid var(--border);background:var(--panel);
  display:grid;place-items:center;cursor:pointer;transition:transform .12s ease, box-shadow .2s ease, border-color .2s ease
}
.icon-round:hover{box-shadow:0 0 0 4px var(--accent-ghost)}
.icon-round:active{transform:scale(.96)}
.mic-recording{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-ghost)}

.center{display:grid;place-items:start;padding:22px 16px}
.box{width:min(900px,92vw);display:flex;flex-direction:column;gap:16px}
.helper{text-align:left;color:var(--muted);font-size:13px}

/* Shortcuts strip */
.strip{display:flex;gap:10px;padding:8px;border:1px dashed var(--border);border-radius:14px;background:var(--panel);box-shadow:var(--shadow);overflow:auto;scroll-snap-type:x mandatory;user-select:none}
.shortcut{scroll-snap-align:start;display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);background:var(--panel);border-radius:14px;cursor:pointer;position:relative;transition:transform .15s ease, border-color .15s ease}
.shortcut:hover{transform:translateY(-2px);border-color:var(--accent)}
.shortcut img{width:20px;height:20px;border-radius:6px}
.shortcut .ph{width:20px;height:20px;border-radius:6px;display:grid;place-items:center;background:var(--chip);color:var(--chip-fg);font-size:12px;font-weight:700}
.shortcut .title{font-weight:600;white-space:nowrap;max-width:220px;overflow:hidden;text-overflow:ellipsis}
.shortcut .del{position:absolute;top:-6px;right:-6px;width:20px;height:20px;border-radius:50%;border:1px solid var(--border);background:var(--accent-ghost);color:var(--fg);display:flex;align-items:center;justify-content:center;cursor:pointer}

/* Results */
.results{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.result{border:1px solid var(--border);background:var(--panel);border-radius:14px;padding:12px 14px;box-shadow:var(--shadow)}
.result .r-title{font-weight:700;margin:0 0 6px}
.result .r-url{color:var(--muted);font-size:12px;margin-bottom:8px;word-break:break-all}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:var(--panel);border-radius:999px;padding:6px 10px;cursor:pointer}

.fade{animation:fade .22s ease forwards;opacity:0;transform:translateY(4px)}
@keyframes fade{to{opacity:1;transform:none}}

.footer{text-align:center;color:var(--muted);padding:24px 0 40px;font-size:12px}

/* Mobile optimization */
@media (max-width: 600px) {
  .topbar {
    flex-wrap: wrap;
    gap: 6px;
    padding: 8px 10px;
  }
  .brand-link {
    padding: 6px 10px;
    font-size: 14px;
  }
  .iconbtn {
    padding: 8px 10px;
    font-size: 14px;
  }
  .hero-inner {
    gap: 8px;
  }
  .search-shell {
    padding: 8px 10px;
    gap: 6px;
  }
  .search-shell input {
    font-size: 14px;
  }
  .icon-round {
    width: 32px;
    height: 32px;
  }
  /* Prevent horizontal scroll on small devices */
  .strip {
    padding: 6px;
    gap: 6px;
  }
  .shortcut {
    padding: 8px 10px;
  }
  .result {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
  }
}
</style>
</head>
<body>
<div class="wrapper">

  <!-- Topbar -->
  <div class="topbar">
    <div class="brand-wrap">
      <div class="bi-box" title="Bioinformatics">BI</div>
      <a class="brand-link" href="https://conbio.netlify.app/" target="_blank" rel="noopener">bioinformatics.Sync</a>
    </div>
    <div class="actions">
      <!-- Home → To-Do -->
      <button class="iconbtn" id="todoBtn" title="Open To-Do">
        <span>To-Do</span>
      </button>
      <button class="iconbtn" id="addBtn" title="Add Shortcut">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 3h9a2 2 0 0 1 2 2v15l-6-3-6 3V5a2 2 0 0 1 2-2z"/><path d="M12 8v6"/><path d="M9 11h6"/></svg>
        <span>Add</span>
      </button>
      <button class="iconbtn" id="themeBtn" title="Toggle theme">
        <svg class="icon" id="sunMoon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <mask id="moon-mask"><rect x="0" y="0" width="24" height="24" fill="white"/><circle id="moon-cut" cx="18" cy="6" r="8" fill="black"/></mask>
          <g id="sun" mask="url(#moon-mask)"><circle cx="12" cy="12" r="5"/><g id="rays"><line x1="12" y1="1" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/><line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/><line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/></g></g>
        </svg>
        <span>Theme</span>
      </button>
    </div>
  </div>

  <!-- Hero search (outside main content) -->
  <div class="hero">
    <div class="hero-inner">
      <div class="logo-dot" aria-hidden="true"></div>
      <div class="search-shell" id="searchShell">
        <div class="left-ico" aria-hidden="true">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
        </div>
        <input id="q" type="text" placeholder="Search Google…" autocomplete="off" />
        <div class="right-ico">
          <button id="micBtn" class="icon-round" title="Voice search">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z"/><path d="M19 11a7 7 0 0 1-14 0"/><path d="M12 19v2m0 0h-4m4 0h4"/></svg>
          </button>
          <button class="icon-round" id="goBtn" title="Search">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5l7 7-7 7"/></svg>
          </button>
        </div>
      </div>
      <div class="helper" id="quotaNote">100 Google searches/day → then auto-switches to DuckDuckGo (resets daily).</div>
    </div>
  </div>

  <!-- Main content (shortcuts + results) -->
  <div class="center">
    <div class="box">
      <div class="strip" id="strip"></div>

      <div class="results" id="results"></div>
      <div class="row" id="pager" style="display:none;">
        <button class="iconbtn" id="prevBtn">◀ Prev</button>
        <button class="iconbtn" id="nextBtn">Next ▶</button>
      </div>
    </div>
  </div>

  <div class="footer">Shortcuts are saved locally • Theme persists • To-Do opens your link.</div>
</div>

<script>
// ====== CONFIG ======
const API_KEY = "AIzaSyD82IhYVKT5KSrMJ9Qy_5067wzl8fB6_fE"; // keep visible (restrict by HTTP referrer)
const CX = "d07f5fa4e5bd340d3"; // Search Engine ID
const TODO_URL = "https://example.com/todo"; // ← change this later
const DAILY_LIMIT = 100; // switch to DDG after this many searches per day

// ====== Elements ======
const $$ = sel => document.querySelector(sel);
const input = $$('#q');
const resultsEl = $$('#results');
const pager = $$('#pager');
const prevBtn = $$('#prevBtn');
const nextBtn = $$('#nextBtn');
const strip = $$('#strip');
const micBtn = $$('#micBtn');
const searchShell = $$('#searchShell');
const quotaNote = $$('#quotaNote');

// ====== Theme (persist) ======
function setTheme(t){document.documentElement.setAttribute('data-theme',t);localStorage.setItem('study_theme',t);}
setTheme(localStorage.getItem('study_theme')||'light');
$$('#themeBtn').addEventListener('click',()=>{
  const next = document.documentElement.getAttribute('data-theme')==='light'?'dark':'light';
  setTheme(next);
});

// ====== To-Do / Add shortcut ======
$$('#todoBtn').addEventListener('click',()=>window.open(TODO_URL,'_blank'));
$$('#addBtn').addEventListener('click',()=>{
  const url = prompt('Paste full URL (https://…) to save as shortcut:');
  if(url) addShortcut(url.trim());
});

// ====== Shortcuts (localStorage) ======
const LS_KEY='study_shortcuts_v5';
function loadShortcuts(){try{return JSON.parse(localStorage.getItem(LS_KEY)||'[]')}catch{return[]}}
function saveShortcuts(x){localStorage.setItem(LS_KEY,JSON.stringify(x))}
function hostnameTitle(url){try{const {hostname}=new URL(url);const base=hostname.replace(/^www\./,'').split('.')[0];return base.charAt(0).toUpperCase()+base.slice(1)}catch{return url}}
function favicon(url){try{const u=new URL(url);return `${u.origin}/favicon.ico`}catch{return ''}}
function renderStrip(){
  const list=[{title:'To-Do',url:TODO_URL,fixed:true},...loadShortcuts()];
  strip.innerHTML='';
  for(const item of list){
    const card=document.createElement('div');card.className='shortcut fade';card.title=item.url;card.addEventListener('click',()=>window.open(item.url,'_blank'));
    const img=document.createElement('img');img.src=favicon(item.url);img.alt='';img.addEventListener('error',()=>{img.replaceWith(letterPH(item.title||hostnameTitle(item.url)))})
    const t=document.createElement('div');t.className='title';t.textContent=item.title||hostnameTitle(item.url);
    card.appendChild(img);card.appendChild(t);
    if(!item.fixed){const del=document.createElement('div');del.className='del';del.textContent='×';del.title='Remove';del.addEventListener('click',e=>{e.stopPropagation();removeShortcut(item.url)});card.appendChild(del)}
    strip.appendChild(card);
  }
}
function letterPH(text){const d=document.createElement('div');d.className='ph';d.textContent=(text||'?').trim().charAt(0).toUpperCase();return d}
function addShortcut(url,title){try{new URL(url)}catch{return alert('Invalid URL')}
  const list=loadShortcuts();if(list.some(x=>x.url===url))return alert('Already saved');
  list.push({title:title||hostnameTitle(url),url});saveShortcuts(list);renderStrip();}
function removeShortcut(url){saveShortcuts(loadShortcuts().filter(x=>x.url!==url));renderStrip();}
renderStrip();

// Drag-scroll shortcuts
let isDown=false,startX=0,scrollLeft=0;
strip.addEventListener('mousedown',e=>{isDown=true;startX=e.pageX-strip.offsetLeft;scrollLeft=strip.scrollLeft});
strip.addEventListener('mouseleave',()=>isDown=false);
strip.addEventListener('mouseup',()=>isDown=false);
strip.addEventListener('mousemove',e=>{if(!isDown) return;e.preventDefault();const x=e.pageX-strip.offsetLeft;strip.scrollLeft=scrollLeft-(x-startX)});

// ====== Daily counter (Google → DDG) ======
const DAY_KEY='study_daily_v1';
function todayStr(){return new Date().toISOString().slice(0,10)}
function getDaily(){
  let obj; try{obj=JSON.parse(localStorage.getItem(DAY_KEY)||'{}')}catch{obj={}}
  if(obj.date!==todayStr()) obj={date:todayStr(), count:0};
  return obj;
}
function saveDaily(o){localStorage.setItem(DAY_KEY,JSON.stringify(o))}
function incDaily(){const o=getDaily(); o.count++; saveDaily(o); return o.count;}
function currentCount(){return getDaily().count}
function updateQuotaNote(){
  const left = Math.max(0, DAILY_LIMIT - currentCount());
  quotaNote.textContent = `${left} Google searches left today → then auto-switches to DuckDuckGo (resets daily).`;
}
updateQuotaNote();

// ====== Google Search (API) with fallback ======
let currentQuery='', startIndex=1;

async function search(q, start=1){
  // If limit reached → open DuckDuckGo directly
  if(currentCount() >= DAILY_LIMIT){
    const ddg = `https://duckduckgo.com/?q=${encodeURIComponent(q)}`;
    resultsEl.innerHTML = `<div class="helper">Daily Google limit reached. Opening DuckDuckGo…</div>`;
    window.open(ddg, '_blank');
    pager.style.display='none';
    return;
  }

  // Count this search
  incDaily(); updateQuotaNote();

  resultsEl.innerHTML='<div class="helper">Searching…</div>';
  try{
    const url=new URL('https://www.googleapis.com/customsearch/v1');
    url.searchParams.set('key',API_KEY);
    url.searchParams.set('cx',CX);
    url.searchParams.set('q',q);
    url.searchParams.set('start',start);
    const res=await fetch(url.toString());
    if(!res.ok){throw new Error('HTTP '+res.status)}
    const data=await res.json();
    renderResults(data);
  }catch(err){
    resultsEl.innerHTML=`<div class="helper">Error: ${err.message}. Check API key/CX or quotas.</div>`;
    pager.style.display='none';
  }
}

function renderResults(data){
  const items=data.items||[];
  resultsEl.innerHTML='';
  if(items.length===0){resultsEl.innerHTML='<div class="helper">No results.</div>';pager.style.display='none';return}
  for(const it of items){
    const card=document.createElement('div');card.className='result fade';
  const header=document.createElement('div');
header.className='result-header';

const title=document.createElement('a');
title.className='r-title';
title.href=it.link;
title.target='_blank';
title.rel='noopener';
title.textContent=it.title||it.link;
title.style.textDecoration='none';

/* Add favicon */
const icon=document.createElement('img');
try {
  const u = new URL(it.link);
  icon.src = `${u.origin}/favicon.ico`;
} catch {
  icon.src = '';
}
icon.alt = '';
icon.style.width = '20px';
icon.style.height = '20px';
icon.style.borderRadius = '4px';

header.appendChild(title);
header.appendChild(icon);
    const url=document.createElement('div');url.className='r-url';url.textContent=it.link;
    const row=document.createElement('div');row.className='row';
    const openBtn=document.createElement('button');openBtn.className='chip';openBtn.innerHTML='↗ Open';openBtn.addEventListener('click',()=>window.open(it.link,'_blank'));
    const saveBtn=document.createElement('button');saveBtn.className='chip';saveBtn.innerHTML='⭐ Save';saveBtn.addEventListener('click',()=>addShortcut(it.link, it.title));
    row.appendChild(openBtn);row.appendChild(saveBtn);
    card.appendChild(header);card.appendChild(url);card.appendChild(row);
    resultsEl.appendChild(card);
  }
  // pager
  const nextStart=(data.queries?.nextPage?.[0]?.startIndex)||null;
  const prevStart=(data.queries?.previousPage?.[0]?.startIndex)||null;
  pager.style.display = (nextStart||prevStart)?'flex':'none';
  nextBtn.disabled=!nextStart; prevBtn.disabled=!prevStart;
  nextBtn.onclick=()=>{ if(!nextStart) return; startIndex=nextStart; search(currentQuery,startIndex); window.scrollTo({top:0,behavior:'smooth'}); };
  prevBtn.onclick=()=>{ if(!prevStart) return; startIndex=prevStart; search(currentQuery,startIndex); window.scrollTo({top:0,behavior:'smooth'}); };
}

// ====== Search triggers ======
function doSearch(){
  const q=input.value.trim(); if(!q){input.focus();return}
  currentQuery=q; startIndex=1; search(q, startIndex);
}
$$('#goBtn').addEventListener('click',doSearch);
input.addEventListener('keydown',e=>{ if(e.key==='Enter') doSearch(); });

// ====== Speech recognition (mic) ======
(function setupSpeech(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ micBtn.title = 'Voice search not supported in this browser'; return; }
  const rec = new SR();
  rec.lang = 'en-US';
  rec.interimResults = false;
  rec.maxAlternatives = 1;
  rec.onstart = ()=> micBtn.classList.add('mic-recording');
  rec.onend   = ()=> micBtn.classList.remove('mic-recording');
  rec.onerror = (e)=> { micBtn.classList.remove('mic-recording'); console.warn('Speech error:', e.error); };
  rec.onresult = (e)=>{
    const text = e.results[0][0].transcript || '';
    if(text){ input.value = text; doSearch(); }
  };
  micBtn.addEventListener('click',()=>{ try{ rec.start(); }catch{} });
})();
</script>
</body>
</html>